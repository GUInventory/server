# Migration `20201107132411-fix-relations`

This migration has been generated by Balint.Kiraly1 <balint.kiraly@protonmail.com> at 11/7/2020, 2:24:11 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE `Warehouse` DROP FOREIGN KEY `warehouse_ibfk_1`

ALTER TABLE `Warehouse` DROP COLUMN `userId`

CREATE TABLE `_UserToWarehouse` (
`A` int  NOT NULL ,
`B` int  NOT NULL ,
UNIQUE INDEX `_UserToWarehouse_AB_unique`(`A`,
`B`),
INDEX `_UserToWarehouse_B_index`(`B`)
) DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `_UserToWarehouse` ADD FOREIGN KEY (`A`) REFERENCES `User`(`id`) ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE `_UserToWarehouse` ADD FOREIGN KEY (`B`) REFERENCES `Warehouse`(`id`) ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201107131557-add-missing-relation..20201107132411-fix-relations
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "mysql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -52,14 +52,13 @@
   name      String
   sizeX     Int
   sizeY     Int
   sizeZ     Int
-  storages  Storage[]
+  storages  Storage[] @relation("WarehouseToStorage")
   createdAt DateTime  @default(now())
   updatedAt DateTime  @updatedAt
-  User      User?     @relation(fields: [userId], references: [id])
-  userId    Int?
-  Role      Role[]
+  users     User[]
+  roles     Role[]
 }
 model Storage {
   id   Int    @id @default(autoincrement())
@@ -69,21 +68,21 @@
   positionY Int
   sizeX     Int
   sizeY     Int
   sizeZ     Int
-  warehouse Warehouse @relation(fields: [warehouseId], references: [id])
+  warehouse Warehouse @relation("WarehouseToStorage", fields: [warehouseId], references: [id])
   createdAt   DateTime @default(now())
   updatedAt   DateTime @updatedAt
-  Item        Item[]
+  items       Item[]   @relation("StorageToItem")
   warehouseId Int
 }
 model Item {
   id         Int         @id @default(autoincrement())
   name       String
   image      String
-  storage    Storage?    @relation(fields: [storageId], references: [id])
+  storage    Storage?    @relation("StorageToItem", fields: [storageId], references: [id])
   value      Int
   outgoings  Outgoing[]
   attributes Attribute[]
@@ -116,9 +115,9 @@
   parent     Category?       @relation("CategoryToCategory", fields: [categoryId], references: [id])
   attributes AttributeType[]
   createdAt  DateTime        @default(now())
   updatedAt  DateTime        @updatedAt
-  Category   Category[]      @relation("CategoryToCategory")
+  children   Category[]      @relation("CategoryToCategory")
   categoryId Int?
 }
 model AttributeType {
```


